<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Chromatic Pitch Recognition</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
<style>
html, body {margin:0;padding:0;height:100%;font-family:'Inter',sans-serif;background:linear-gradient(135deg, #f0f4ff, #d9e4ff);display:flex;justify-content:center;align-items:center;overflow:hidden;}
.container {background:#fff;padding:40px;border-radius:25px;box-shadow:0 15px 40px rgba(0,0,0,0.15);text-align:center;max-width:700px;width:95%;min-height:85vh;display:flex;flex-direction:column;justify-content:center;position:relative;z-index:1;}
h2 {margin-bottom:20px;color:#333;font-weight:600;font-size:2rem;}
.progress-bar-title {font-weight:600;font-size:18px;margin-bottom:6px;color:#555;}
.progress-bar-container {background:#e0e0e0;border-radius:15px;width:100%;height:22px;overflow:hidden;margin-bottom:25px;position:relative;}
.progress-bar {background:linear-gradient(90deg,#6c63ff,#ff6584);width:0%;height:100%;border-radius:15px;transition: width 0.5s ease;}
.progress-bar.celebrate {animation: glow 1s ease-in-out 3;}
@keyframes glow {0%{box-shadow:0 0 10px #ffbf00;}50%{box-shadow:0 0 25px #ffbf00;}100%{box-shadow:0 0 10px #ffbf00;}}
@keyframes milestoneBounce {0%{transform:scale(1);}50%{transform:scale(1.25);}100%{transform:scale(1);}}

input {font-size:20px;padding:15px;border-radius:12px;border:1px solid #ccc;width:90%;margin-bottom:20px;outline:none;transition:0.3s;}
input:focus {border-color:#6c63ff;box-shadow:0 0 12px rgba(108,99,255,0.4);}

button {font-size:18px;padding:15px 25px;margin:8px;border:none;border-radius:15px;cursor:pointer;transition:0.3s;font-weight:600;}
button:hover {transform:translateY(-2px);box-shadow:0 8px 20px rgba(0,0,0,0.25);}
.btn-primary {background:#6c63ff;color:white;}
.btn-secondary {background:#ff6584;color:white;}
.btn-tertiary {background:#33cabb;color:white;}

#result {margin-top:20px;font-weight:600;min-height:28px;font-size:1.2rem;}
#scoreDisplay,#streakDisplay {font-size:22px;margin:8px 0;font-weight:700;transition:transform 0.3s,color 0.3s;}
.score-animate {transform:scale(1.5);color:#ffbf00;}
#streakDisplay.hotstreak {color:#ff4500;text-shadow:0 0 12px #ff6347,0 0 25px #ff4500,0 0 40px #ff0000;animation:streakPulse 1s infinite alternate;}
@keyframes streakPulse {from{transform:scale(1);opacity:1;} to{transform:scale(1.15);opacity:0.8;}}

#currentPitchDisplay {font-size:24px;margin:15px 0;font-weight:600;color:#555;}
.button-row {display:flex;justify-content:center;flex-wrap:wrap;margin-bottom:15px;}
#noteButtonsContainer button {margin:5px;padding:10px 15px;border-radius:10px;border:1px solid #ccc;cursor:pointer;transition:0.2s;background:#eee;}
#noteButtonsContainer button:hover {background:#6c63ff;color:white;}
</style>
</head>
<body>
<div class="container">
<h2>Chromatic Pitch Recognition</h2>

<p class="progress-bar-title" id="milestoneTitle">Milestone: Beginner</p>
<div class="progress-bar-container">
<div class="progress-bar" id="progressBar"></div>
</div>

<p id="scoreDisplay">Score: 0</p>
<p id="streakDisplay">Hot Streak: 0</p>
<p id="currentPitchDisplay"></p>

<div style="margin-bottom:20px;">
<label style="font-weight:600; margin-right:10px;">Sound Set:</label>
<select id="soundSetSelect">
<option value="default">Default</option>
<option value="piano">Piano</option>
<option value="organ">Organ</option>
</select>
</div>

<div style="margin-bottom:20px;">
<label style="font-weight:600; margin-right:10px;">Input Mode:</label>
<select id="inputModeToggle" onchange="toggleInputMode()">
<option value="text">Text Input</option>
<option value="buttons">Select Note</option>
</select>
</div>

<input type="text" id="pitchGuess" placeholder="Enter pitch (e.g., F# or Gb)">
<div id="noteButtonsContainer" style="display:none; flex-wrap:wrap; justify-content:center; margin-bottom:20px;"></div>

<div class="button-row">
<button class="btn-primary" onclick="submitGuess()">Submit Guess</button>
<button class="btn-secondary" onclick="replayPitch()">Replay Pitch</button>
<button class="btn-tertiary" onclick="skipPitch()">Skip</button>
</div>

<p id="result"></p>
</div>

<script>
// --- Pitches & Enharmonics ---
const pitchMap = {
'C3':0,'C#3':0,'Db3':0,'D3':0,'D#3':0,'Eb3':0,'E3':0,'F3':0,'F#3':0,'Gb3':0,'G3':0,'G#3':0,'Ab3':0,'A3':0,'A#3':0,'Bb3':0,'B3':0
};
const enharmonics = {'C#':['C#','DB'],'DB':['C#','DB'],'D#':['D#','EB'],'EB':['D#','EB'],'F#':['F#','GB'],'GB':['F#','GB'],'G#':['G#','AB'],'AB':['G#','AB'],'A#':['A#','BB'],'BB':['A#','BB']};
const noteNames = ['C','C#','Db','D','D#','Eb','E','F','F#','Gb','G','G#','Ab','A','A#','Bb','B'];

// --- Milestones ---
const milestones = Array.from({length:50},(_,i)=>({
points: i*20,
title: ["Beginner","Novice","Apprentice","Skilled","Expert","Maestro","Virtuoso","Legend","Champion","Elite","Ace","Prodigy","Wizard","Guru","Conqueror","Master","Grandmaster","Sage","Virtuoso II","Maestro II","Legend II","Champion II","Elite II","Ace II","Prodigy II","Wizard II","Guru II","Conqueror II","Master II","Grandmaster II","Sage II","Virtuoso III","Maestro III","Legend III","Champion III","Elite III","Ace III","Prodigy III","Wizard III","Guru III","Conqueror III","Master III","Grandmaster III","Sage III","Virtuoso IV","Maestro IV","Legend IV","Champion IV","Elite IV","Ace IV","Ultimate"][i%50],
color:`hsl(${i*7.2},70%,60%)`
}));

// --- Game State ---
let currentPitch='', lastPitch='', pitchCount=0, score=0, potentialPoints=10, replayCount=0, streak=0, streakMultiplier=1, lastMilestoneIndex=-1;

// --- Play pitch from audio file ---
function playPitch(pitchName){
  const set=document.getElementById('soundSetSelect').value||'default';
  const audio=new Audio(`sounds/${set}/${pitchName}.mp3`);
  audio.play();
}

// --- Next pitch ---
function nextPitch(){
  const pitches=Object.keys(pitchMap); let selected;
  do { selected=pitches[Math.floor(Math.random()*pitches.length)]; } while(selected===lastPitch);
  currentPitch=selected; lastPitch=currentPitch;
  playPitch(currentPitch);
  pitchCount++; potentialPoints=10; replayCount=0;
  document.getElementById('currentPitchDisplay').textContent=`Pitch ${pitchCount}`;
  document.getElementById('pitchGuess').value=''; document.getElementById('result').textContent='';
  updateProgressBar();
}

// --- Progress bar & milestones ---
function updateProgressBar(){
  const progressEl=document.getElementById('progressBar'); 
  const milestoneEl=document.getElementById('milestoneTitle');
  let currentMilestone=milestones[0], nextMilestone=milestones[milestones.length-1], currentIndex=0;
  for(let i=0;i<milestones.length;i++){
    if(score>=milestones[i].points){ currentMilestone=milestones[i]; currentIndex=i; nextMilestone=milestones[i+1]||milestones[i]; }
  }
  const start=currentMilestone.points, end=nextMilestone.points;
  let percent=end===start?100:((score-start)/(end-start))*100; percent=Math.min(Math.max(percent,0),100);
  progressEl.style.width=percent+'%';
  progressEl.style.background=`linear-gradient(90deg, ${currentMilestone.color}, #fff)`;
  milestoneEl.textContent=`Milestone: ${currentMilestone.title}`;
  if(currentIndex!==lastMilestoneIndex && currentIndex>0){ celebrateMilestone(); lastMilestoneIndex=currentIndex; }
}

// --- Celebrate milestone ---
function celebrateMilestone(){ 
  const progressEl=document.getElementById('progressBar'); 
  const container=document.querySelector('.container'); 
  const milestoneEl=document.getElementById('milestoneTitle');
  progressEl.classList.add("celebrate"); 
  const milestoneIndex=lastMilestoneIndex; 
  const color=milestones[milestoneIndex]?.color||"#ffbf00";
  progressEl.style.background=`linear-gradient(90deg, ${color}, #fff)`;
  container.style.boxShadow=`0 0 60px 20px ${color}AA, 0 15px 40px rgba(0,0,0,0.15)`;
  container.style.transition='box-shadow 0.5s ease-in-out';
  milestoneEl.style.animation='milestoneBounce 0.8s ease-in-out';
  setTimeout(()=>milestoneEl.style.animation='',800);
  setTimeout(()=>{progressEl.classList.remove("celebrate"); progressEl.style.background="linear-gradient(90deg, #6c63ff, #ff6584)"; container.style.boxShadow='0 15px 40px rgba(0,0,0,0.15)';},1200);
  launchConfettiBurst(color); sparkleProgressBar(color);
}

function launchConfettiBurst(color="#ffbf00"){for(let i=0;i<100;i++){const c=document.createElement('div');c.style.position='fixed';c.style.width='10px';c.style.height='10px';c.style.backgroundColor=color;c.style.left=Math.random()*window.innerWidth+'px';c.style.top='-10px';c.style.opacity='0.8';c.style.zIndex='999';document.body.appendChild(c); const fall=()=>{ const t=parseFloat(c.style.top); if(t<window.innerHeight+10){c.style.top=t+Math.random()*8+2+'px'; c.style.left=parseFloat(c.style.left)+Math.random()*6-3+'px'; c.style.transform=`rotate(${Math.random()*360}deg)`; requestAnimationFrame(fall);} else c.remove(); }; requestAnimationFrame(fall); }}

function sparkleProgressBar(color){const bar=document.getElementById('progressBar'); for(let i=0;i<10;i++){const s=document.createElement('div'); s.style.position='absolute'; s.style.width='6px'; s.style.height='6px'; s.style.backgroundColor=color; s.style.borderRadius='50%'; s.style.top=Math.random()*100+'%'; s.style.left=Math.random()*100+'%'; s.style.opacity='0.8'; s.style.zIndex='2'; bar.appendChild(s); setTimeout(()=>s.remove(),800); }}

// --- Replay, skip, normalize input ---
function replayPitch(){if(!currentPitch)return; playPitch(currentPitch); replayCount++; if(potentialPoints>1) potentialPoints--; }
function skipPitch(){document.getElementById('result').textContent="⏭️ Pitch skipped. No points awarded."; resetStreak(); setTimeout(nextPitch,1200); }
function normalizeInput(input){return input.trim().replace('♯','#').replace('♭','b').toUpperCase().replace(/[0-9]/g,'');}

// --- Submit guess ---
function submitGuess(){
  const userGuess=normalizeInput(document.getElementById('pitchGuess').value); if(!userGuess)return;
  const resultEl=document.getElementById('result'); const streakEl=document.getElementById('streakDisplay'); const scoreEl=document.getElementById('scoreDisplay');
  const basePitch=currentPitch.replace(/[0-9]/g,'').toUpperCase();
  const validAnswers=enharmonics[basePitch]||[basePitch];

  if(validAnswers.includes(userGuess)){
    let earned=potentialPoints; 
    if(replayCount<=1){ streak++; streakMultiplier*=1.1; earned=Math.round(earned*streakMultiplier); streakEl.classList.add("hotstreak"); } else resetStreak();
    score+=earned; scoreEl.textContent=`Score: ${score}`; animateScore(scoreEl);
    streakEl.textContent=`Hot Streak: ${streak}`; resultEl.textContent=`🎉 Correct! +${earned} points`; resultEl.style.color='green';
  } else{ resultEl.textContent=`❌ Incorrect. The correct answer was ${validAnswers.join(" or ")}`; resultEl.style.color='red'; resetStreak(); }

  updateProgressBar(); setTimeout(nextPitch,1200);
}

function resetStreak(){streak=0; streakMultiplier=1; const streakEl=document.getElementById('streakDisplay'); streakEl.textContent='Hot Streak: 0'; streakEl.classList.remove("hotstreak");}
function animateScore(el){el.classList.add("score-animate"); setTimeout(()=>el.classList.remove("score-animate"),400);}

// --- Input mode toggle ---
function toggleInputMode(){ const mode=document.getElementById('inputModeToggle').value; const textInput=document.getElementById('pitchGuess'); const buttonsContainer=document.getElementById('noteButtonsContainer'); if(mode==='text'){textInput.style.display='block'; buttonsContainer.style.display='none';} else {textInput.style.display='none'; buttonsContainer.style.display='flex'; renderNoteButtons();} }

function renderNoteButtons(){ const container=document.getElementById('noteButtonsContainer'); container.innerHTML=''; noteNames.forEach(note=>{ const btn=document.createElement('button'); btn.textContent=note; btn.onclick=()=>{ document.getElementById('pitchGuess').value=note; submitGuess(); }; container.appendChild(btn); }); }

document.getElementById('pitchGuess').addEventListener('keydown', e=>{ if(e.key==='Enter') submitGuess(); });
window.onload=()=>nextPitch();
</script>
</body>
</html>
